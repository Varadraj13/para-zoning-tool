<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NYC Parametric Zoning Tool</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
</head>
<body>
  <!-- NYC-style Top Bar -->
  <nav class="topnav">
    <div class="nav-left">
      <svg class="nyc-logo" viewBox="0 0 32 32" width="24" height="24">
        <path fill="#FF6B00" d="M8 4h16v24H8z"/>
      </svg>
      <div class="nav-title">
        <h1>Parametric Zoning Tool</h1>
        <p class="subtitle">NYC Property & Zoning Analysis</p>
      </div>
    </div>
    <div class="nav-actions">
      <button class="nav-btn">Search Properties</button>
      <button class="nav-btn">Documentation</button>
      <button class="nav-btn">API</button>
      <button class="nav-btn user-menu">User</button>
    </div>
  </nav>

  <!-- Step Indicator -->
  <div class="stepper" role="navigation" aria-label="Progress">
    <ol>
      <li class="step active" data-step="1"><span class="bubble">1</span><span>Select Site</span></li>
      <li class="step" data-step="2"><span class="bubble">2</span><span>Program & Rules</span></li>
      <li class="step" data-step="3"><span class="bubble">3</span><span>Generate & Analyze</span></li>
    </ol>
  </div>

  <!-- Persistent Map Container -->
  <div class="app-container">
    <!-- Left: Map (Always Visible) -->
    <div class="map-panel persistent-map">
      <div class="map-header">
        <div class="search-bar">
          <input type="text" id="address-search" placeholder="Search by Address, BBL, or Coordinates..." class="address-input" />
          <button class="search-btn">üîç</button>
        </div>
        <div class="map-controls">
          <button class="map-btn" title="Zoom in">+</button>
          <button class="map-btn" title="Zoom out">‚àí</button>
          <button class="map-btn" title="Reset view">‚ü≤</button>
        </div>
      </div>
      <div class="map-viewport">
        <div id="map" class="map"></div>
      </div>
    </div>

    <!-- Right: Content Panels (Switch by Step) -->
    <div class="content-panels">
      <!-- STEP 1: Site Selection -->
      <section class="step-view active" id="step-1">
        <!-- Property Details Panel -->
        <div class="details-panel">
        <div class="panel-section active" id="property-details">
          <div class="panel-header">
            <h2>Property Details</h2>
            <div class="quick-tabs">
              <button class="tab-btn active" data-tab="property-info">Info</button>
              <button class="tab-btn" data-tab="building-info">Building</button>
              <button class="tab-btn" data-tab="land-info">Land</button>
              <button class="tab-btn" data-tab="zoning-info">Zoning</button>
            </div>
          </div>

          <!-- Property Info Tab -->
          <div class="tab-content" id="property-info">
            <div class="property-header">
              <h3 id="prop-address"><span id="prop-address">‚Äî</span></h3>
              <div class="property-meta">
                <span class="meta-item"><strong>Borough:</strong> <span id="prop-borough">‚Äî</span></span>
                <span class="meta-item"><strong>Block:</strong> <span id="prop-block">‚Äî</span></span>
                <span class="meta-item"><strong>Lot:</strong> <span id="prop-lot">‚Äî</span></span>
              </div>
            </div>

            <div class="accordion-group">
              <details class="accordion-item" open>
                <summary class="accordion-header">
                  <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="3" width="12" height="10" stroke="#222" stroke-width="2" rx="2"/><rect x="5" y="1" width="6" height="2" fill="#222"/></svg></span>
                  <span class="title">Property Information</span>
                </summary>
                <div class="accordion-body">
                  <div class="data-row">
                    <span class="label">Owner</span>
                    <span class="value" id="prop-owner">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Lot Area</span>
                    <span class="value" id="prop-lotarea">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Type</span>
                    <span class="value" id="prop-type">‚Äî</span>
                  </div>
                </div>
              </details>

              <details class="accordion-item" open>
                <summary class="accordion-header">
                  <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="3" y="3" width="10" height="10" stroke="#222" stroke-width="2"/><rect x="6" y="6" width="1" height="1" fill="#222"/><rect x="9" y="6" width="1" height="1" fill="#222"/><rect x="6" y="9" width="1" height="1" fill="#222"/><rect x="9" y="9" width="1" height="1" fill="#222"/></svg></span>
                  <span class="title">Building Information</span>
                </summary>
                <div class="accordion-body">
                  <div class="data-row">
                    <span class="label">Buildings</span>
                    <span class="value" id="bldg-count">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Year Built</span>
                    <span class="value" id="bldg-year">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Stories</span>
                    <span class="value" id="bldg-stories">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Total Area</span>
                    <span class="value" id="bldg-area">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Residential Units</span>
                    <span class="value" id="bldg-resu">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Commercial Units</span>
                    <span class="value" id="bldg-comu">‚Äî</span>
                  </div>
                </div>
              </details>

              <details class="accordion-item">
                <summary class="accordion-header">
                  <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="10" width="12" height="4" stroke="#222" stroke-width="2"/><rect x="6" y="2" width="4" height="8" stroke="#222" stroke-width="2"/></svg></span>
                  <span class="title">Development Potential</span>
                </summary>
                <div class="accordion-body">
                  <div class="data-row">
                    <span class="label">Current FAR</span>
                    <span class="value" id="dev-far">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Max FAR (As-of-right)</span>
                    <span class="value" id="dev-maxfar">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Max Height</span>
                    <span class="value" id="dev-height">‚Äî</span>
                  </div>
                  <div class="data-row">
                    <span class="label">Setback Requirements</span>
                    <span class="value" id="dev-setback">‚Äî</span>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <!-- Other Tabs -->
          <div class="tab-content" id="building-info" style="display:none;">
            <div class="building-metrics">
              <div class="metric-card">
                <div class="metric-label">Construction Type</div>
                <div class="metric-value" id="metric-construct">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Building Frontage</div>
                <div class="metric-value" id="metric-frontage">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Building Depth</div>
                <div class="metric-value" id="metric-depth">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Basements</div>
                <div class="metric-value" id="metric-basements">‚Äî</div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="land-info" style="display:none;">
            <div class="building-metrics">
              <div class="metric-card">
                <div class="metric-label">Land Area</div>
                <div class="metric-value" id="metric-land">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Lot Shape</div>
                <div class="metric-value" id="metric-shape">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Corner Lot</div>
                <div class="metric-value" id="metric-corner">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Assessed Value</div>
                <div class="metric-value" id="metric-value">‚Äî</div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="zoning-info" style="display:none;">
            <div class="building-metrics">
              <div class="metric-card">
                <div class="metric-label">Zoning District</div>
                <div class="metric-value" id="metric-zone">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Community Board</div>
                <div class="metric-value" id="metric-cb">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Special District</div>
                <div class="metric-value" id="metric-special">‚Äî</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Historic District</div>
                <div class="metric-value" id="metric-historic">‚Äî</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Continue Button -->
        <div class="panel-footer">
          <button class="action-btn primary w-full" id="step1-continue" disabled>Continue to Program & Rules ‚Üí</button>
        </div>
        </div>
      </section>

      <!-- STEP 2: Program & Regulations -->
      <section class="step-view" id="step-2">
        <!-- Left: Settings Panel -->
        <div class="settings-panel">
        <div class="panel-header">
          <h2>Program & Regulations</h2>
        </div>

        <div class="settings-content">
          <div class="setting-group">
            <label for="program-type">Program Type</label>
            <select id="program-type">
              <option>Residential</option>
              <option>Mixed-use</option>
              <option>Commercial</option>
              <option>Industrial</option>
            </select>
          </div>

          <details class="accordion-item" open>
            <summary class="accordion-header">
              <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><polyline points="2,14 14,2" stroke="#222" stroke-width="2"/><rect x="2" y="12" width="2" height="2" fill="#222"/><rect x="12" y="2" width="2" height="2" fill="#222"/></svg></span>
              <span class="title">Zoning Parameters</span>
            </summary>
            <div class="accordion-body">
              <div class="setting-group">
                <label for="far">Target FAR</label>
                <input id="far" type="number" placeholder="e.g., 9.5" step="0.1" />
                <p id="far-error" class="error"></p>
              </div>

              <div class="setting-group">
                <label for="max-height">Max Height (ft)</label>
                <input id="max-height" type="number" placeholder="e.g., 1000" />
              </div>
            </div>
          </details>

          <details class="accordion-item">
            <summary class="accordion-header">
              <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="3" y="6" width="10" height="7" stroke="#222" stroke-width="2"/><rect x="2" y="6" width="12" height="2" fill="#222"/><rect x="6" y="2" width="4" height="4" stroke="#222" stroke-width="2"/></svg></span>
              <span class="title">Available Bonuses</span>
            </summary>
            <div class="accordion-body">
              <div class="bonus-item">
                <label class="checkbox-label">
                  <input type="checkbox" value="inclusionary" class="bonus-check" />
                  <div class="bonus-text">
                    <strong>Inclusionary Housing</strong>
                    <p>+20% FAR for 25% affordable units</p>
                  </div>
                </label>
              </div>
              <div class="bonus-item">
                <label class="checkbox-label">
                  <input type="checkbox" value="plaza" class="bonus-check" />
                  <div class="bonus-text">
                    <strong>Plaza/Greenspace</strong>
                    <p>+10% FAR for 5,000 sf public plaza</p>
                  </div>
                </label>
              </div>
              <div class="bonus-item">
                <label class="checkbox-label">
                  <input type="checkbox" value="transit" class="bonus-check" />
                  <div class="bonus-text">
                    <strong>Transit-Oriented</strong>
                    <p>+15% FAR near transit</p>
                  </div>
                </label>
              </div>
            </div>
          </details>

          <details class="accordion-item">
            <summary class="accordion-header">
              <span class="icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="3" stroke="#222" stroke-width="2"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.5 3.5l1.5 1.5M11 11l1.5 1.5M3.5 12.5l1.5-1.5M11 5l1.5-1.5" stroke="#222" stroke-width="1.5"/></svg></span>
              <span class="title">Building Systems</span>
            </summary>
            <div class="accordion-body">
              <div class="setting-group">
                <label for="wwr">Window-to-Wall Ratio (%)</label>
                <input id="wwr" type="number" placeholder="e.g., 40" min="0" max="95" />
                <p id="wwr-error" class="error"></p>
              </div>

              <div class="setting-group">
                <label for="energy-mode">Energy Mode</label>
                <select id="energy-mode">
                  <option>Auto-generated</option>
                  <option>Custom</option>
                </select>
              </div>

              <div class="setting-group">
                <label for="notes">MEP Notes</label>
                <textarea id="notes" placeholder="HVAC, Lighting, SWH parameters..."></textarea>
              </div>
            </div>
          </details>
        </div>

        <div class="panel-footer">
          <button class="action-btn outline w-full" id="step2-back">‚Üê Back to Site</button>
          <button class="action-btn primary w-full" id="step2-continue" disabled>Generate Envelope ‚Üí</button>
          <p id="gate-note" class="hint">Complete required fields to proceed.</p>
        </div>
        </div>
      </section>

      <!-- STEP 3: Generate & Analyze -->
      <section class="step-view" id="step-3">
        <!-- Left: Analysis Panel -->
        <div class="analysis-panel">
        <div class="panel-header">
          <h2>Generate & Analyze</h2>
        </div>

        <div class="analysis-content">
          <div class="action-group">
            <h3>Analysis Actions</h3>
            <button class="action-btn primary w-full" id="generate-envelope">
              <span><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="12" stroke="#222" stroke-width="2"/><rect x="5" y="5" width="6" height="6" fill="#222"/></svg></span> Generate Max Envelope
            </button>
            <button class="action-btn secondary w-full" id="optimize-massing">
              <span><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><polygon points="8,2 10,10 2,6 14,6 6,10" fill="#222"/></svg></span> Optimize Massing
            </button>
            <button class="action-btn outline w-full" id="export-report">
              <span><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="3" y="2" width="10" height="12" stroke="#222" stroke-width="2"/><rect x="6" y="6" width="4" height="1" fill="#222"/><rect x="6" y="9" width="4" height="1" fill="#222"/></svg></span> Export Report (PDF)
            </button>
          </div>

          <div class="results-group">
            <h3>Envelope Results</h3>
            <div class="metric-box">
              <div class="metric-label">Volume</div>
              <div class="metric-value" id="result-volume">‚Äî</div>
            </div>
            <div class="metric-box">
              <div class="metric-label">GFA</div>
              <div class="metric-value" id="result-gfa">‚Äî</div>
            </div>
            <div class="metric-box">
              <div class="metric-label">Achieved FAR</div>
              <div class="metric-value" id="result-far">‚Äî</div>
            </div>
          </div>

          <div class="status-message" id="status-msg" style="display:none;"></div>
        </div>

        <div class="panel-footer">
          <button class="action-btn outline w-full" id="step3-back">‚Üê Back</button>
        </div>
        </div>

        <!-- Right: Results Panel -->
        <div class="results-panel">
        <div class="panel-header">
          <h2>3D Results</h2>
        </div>

        <div class="preview-box">
          <div class="preview-placeholder">
            <p>3D Massing Result</p>
            <p class="small">(Interactive visualization coming)</p>
          </div>
        </div>

        <div class="results-summary">
          <h3>Optimized Configurations</h3>
          <div class="result-option">
            <div class="option-name">FAR-Maximized</div>
            <div class="option-metrics">
              <span>FAR: 9.5</span>
              <span>Efficiency: 89%</span>
            </div>
          </div>
          <div class="result-option">
            <div class="option-name">Light-Optimized</div>
            <div class="option-metrics">
              <span>FAR: 8.0</span>
              <span>Efficiency: 92%</span>
            </div>
          </div>
        </div>
        </div>
      </section>
    </div>
  </div>

  <footer class="footer">¬© 2025 NYC Parametric Zoning Tool ‚Äì City Planning Analytics</footer>
  <script src="app.js"></script>
</body>
</html>
